{% extends "base.html" %}

{% block title %}Dashboard - WooCommerce Manager{% endblock %}

{% block extra_css %}
<style>
    :root {
        --primary-gradient: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        --card-bg: #ffffff;
        --bg-hover: #f8fafc;
        --text-main: #1e293b;
        --text-muted: #64748b;
        --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.05), 0 1px 2px rgba(0, 0, 0, 0.1);
        --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.025);
        --radius-lg: 16px;
        --radius-md: 12px;
    }

    [data-theme="dark"] {
        --card-bg: #1e293b;
        --bg-hover: #334155;
        --text-main: #f8fafc;
        --text-muted: #94a3b8;
        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
    }

    /* Ajustes generales */
    body {
        background-color: #f1f5f9;
        /* Fondo gris muy suave para contraste */
    }

    /* 1. HEADER MODERNIZADO */
    .welcome-header {
        background: var(--primary-gradient);
        color: white;
        border-radius: var(--radius-lg);
        padding: 2rem 1.5rem;
        margin-bottom: 2rem;
        position: relative;
        overflow: hidden;
        box-shadow: 0 20px 25px -5px rgba(79, 70, 229, 0.3);
    }

    /* Decoraci贸n de fondo sutil */
    .welcome-header::after {
        content: '';
        position: absolute;
        top: -50%;
        right: -10%;
        width: 300px;
        height: 300px;
        background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0) 70%);
        border-radius: 50%;
        pointer-events: none;
    }

    .welcome-header h1 {
        font-weight: 700;
        font-size: 1.75rem;
        margin-bottom: 0.5rem;
        letter-spacing: -0.025em;
    }

    .welcome-header .badge {
        backdrop-filter: blur(4px);
        background-color: rgba(255, 255, 255, 0.2) !important;
        color: white !important;
        font-weight: 500;
        padding: 0.5em 0.8em;
    }

    /* 2. TARJETAS DE ACCIN (Modern Cards) */
    .section-title {
        font-size: 1rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--text-muted);
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .quick-action-card {
        background: var(--card-bg);
        border-radius: var(--radius-lg);
        padding: 1.5rem;
        text-decoration: none;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border: 1px solid rgba(255, 255, 255, 0.5);
        box-shadow: var(--shadow-sm);
        height: 100%;
        position: relative;
        overflow: hidden;
    }

    .quick-action-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-md);
        background: white;
    }

    /* Contenedor del icono con fondo suave */
    .icon-box {
        width: 50px;
        height: 50px;
        border-radius: var(--radius-md);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        margin-bottom: 1rem;
        transition: transform 0.3s ease;
    }

    .quick-action-card:hover .icon-box {
        transform: scale(1.1);
    }

    .quick-action-card h5 {
        color: var(--text-main);
        font-weight: 600;
        font-size: 1.1rem;
        margin-bottom: 0.25rem;
    }

    .quick-action-card small {
        color: var(--text-muted);
        font-size: 0.9rem;
    }

    /* Temas de color para las tarjetas */
    .theme-products .icon-box {
        background: #eff6ff;
        color: #3b82f6;
    }

    /* Azul */
    .theme-stock .icon-box {
        background: #f0f9ff;
        color: #0ea5e9;
    }

    /* Celeste */
    .theme-whatsapp .icon-box {
        background: #dcfce7;
        color: #22c55e;
    }

    /* Verde WA */
    .theme-external .icon-box {
        background: #fff7ed;
        color: #f97316;
    }

    /* Naranja */

    /* Indicador de flecha sutil */
    .action-arrow {
        position: absolute;
        top: 1.5rem;
        right: 1.5rem;
        color: #cbd5e1;
        transition: 0.3s;
    }

    .quick-action-card:hover .action-arrow {
        color: var(--text-main);
        transform: translateX(3px);
    }

    /* 3. ESTADSTICAS (Clean Stats) */
    .stat-card {
        background: var(--card-bg);
        border-radius: var(--radius-lg);
        padding: 1.5rem;
        border: none;
        box-shadow: var(--shadow-sm);
        display: flex;
        align-items: center;
        justify-content: space-between;
        height: 100%;
    }

    .stat-info {
        display: flex;
        flex-direction: column;
    }

    .stat-label {
        color: var(--text-muted);
        font-size: 0.85rem;
        font-weight: 500;
        margin-bottom: 4px;
    }

    .stat-number {
        font-size: 1.75rem;
        font-weight: 700;
        color: var(--text-main);
        line-height: 1.2;
    }

    .stat-icon-mini {
        width: 42px;
        height: 42px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        opacity: 0.9;
    }

    /* Variaciones de stats */
    .stat-total .stat-icon-mini {
        background: #f1f5f9;
        color: #64748b;
    }

    .stat-success .stat-icon-mini {
        background: #dcfce7;
        color: #16a34a;
    }

    .stat-danger .stat-icon-mini {
        background: #fee2e2;
        color: #dc2626;
    }

    .stat-warning .stat-icon-mini {
        background: #fef3c7;
        color: #d97706;
    }

    /* Efecto de carga (Skeleton) */
    .loading-pulse {
        animation: pulse-bg 1.5s infinite;
        background-color: #e2e8f0;
        color: transparent !important;
        border-radius: 4px;
        width: fit-content;
        min-width: 30px;
    }

    @keyframes pulse-bg {
        0% {
            opacity: 0.6;
        }

        50% {
            opacity: 1;
        }

        100% {
            opacity: 0.6;
        }
    }

    /* Responsive adjustments */
    @media (min-width: 992px) {
        .welcome-header {
            padding: 3rem;
        }

        .welcome-header h1 {
            font-size: 2.25rem;
        }
    }

    /* 4. TARJETAS DE INFORMACIN (Vertical Layout) */
    .info-card {
        background: var(--card-bg);
        border-radius: var(--radius-lg);
        padding: 1.5rem;
        border: none;
        box-shadow: var(--shadow-sm);
        height: 100%;
        display: flex;
        flex-direction: column;
        /* Apilar elementos verticalmente */
        justify-content: flex-start;
        /* Alinear al principio */
        align-items: stretch;
        /* Ocupar todo el ancho */
    }
</style>
{% endblock %}

{% block content %}

<div class="welcome-header">
    <div class="row align-items-center">
        <div class="col-md-8">
            <h1>Hola, {{ current_user.full_name.split()[0] if current_user.full_name else current_user.username }} 
            </h1>
            <p class="mb-0 opacity-75">
                Aqu铆 tienes el resumen de tu tienda hoy.
                {% if current_user.is_admin() %}
                <span class="badge ms-2">Administrador</span>
                {% elif current_user.is_advisor() %}
                <span class="badge ms-2">Asesor</span>
                {% else %}
                <span class="badge ms-2">Usuario</span>
                {% endif %}
            </p>
        </div>
    </div>
</div>

<div class="mb-5">
    <h2 class="section-title">
        <i class="bi bi-grid-fill"></i> Gesti贸n Principal
    </h2>

    <div class="row g-4">
        <div class="col-12 col-md-6 col-xl-3">
            <a href="{{ url_for('orders.index') }}" class="quick-action-card theme-whatsapp">
                <i class="bi bi-chevron-right action-arrow"></i>
                <div class="icon-box">
                    <i class="bi bi-whatsapp"></i>
                </div>
                <h5>Pedidos WA</h5>
                <small>Solicitudes directas</small>
            </a>
        </div>

        <div class="col-12 col-md-6 col-xl-3">
            <a href="{{ url_for('stock.index') }}" class="quick-action-card theme-stock">
                <i class="bi bi-chevron-right action-arrow"></i>
                <div class="icon-box">
                    <i class="bi bi-clipboard-data"></i>
                </div>
                <h5>Inventario</h5>
                <small>Control de stock</small>
            </a>
        </div>

        <div class="col-12 col-md-6 col-xl-3">
            <a href="{{ url_for('products.index') }}" class="quick-action-card theme-products">
                <i class="bi bi-chevron-right action-arrow"></i>
                <div class="icon-box">
                    <i class="bi bi-box-seam"></i>
                </div>
                <h5>Productos</h5>
                <small>Gesti贸n de cat谩logo</small>
            </a>
        </div>

        <div class="col-12 col-md-6 col-xl-3">
            <a href="{{ url_for('prices.index') }}" class="quick-action-card theme-external">
                <i class="bi bi-chevron-right action-arrow"></i>
                <div class="icon-box">
                    <i class="bi bi-currency-dollar"></i>
                </div>
                <h5>Precios</h5>
                <small>Actualizaci贸n de precios</small>
            </a>
        </div>
    </div>
</div>

<div class="mb-4">
    <h3 class="section-title">
        <i class="bi bi-activity"></i> Estado del Inventario
    </h3>

    <div class="row g-4">
        <div class="col-6 col-lg-3">
            <div class="stat-card stat-total">
                <div class="stat-info">
                    <span class="stat-label">Total Productos</span>
                    <span class="stat-number loading-pulse" id="total-products">-</span>
                </div>
                <div class="stat-icon-mini">
                    <i class="bi bi-layers"></i>
                </div>
            </div>
        </div>

        <div class="col-6 col-lg-3">
            <div class="stat-card stat-success">
                <div class="stat-info">
                    <span class="stat-label">En Stock</span>
                    <span class="stat-number loading-pulse" id="in-stock">-</span>
                </div>
                <div class="stat-icon-mini">
                    <i class="bi bi-check-lg"></i>
                </div>
            </div>
        </div>

        <div class="col-6 col-lg-3">
            <div class="stat-card stat-danger">
                <div class="stat-info">
                    <span class="stat-label">Sin Stock</span>
                    <span class="stat-number loading-pulse" id="out-stock">-</span>
                </div>
                <div class="stat-icon-mini">
                    <i class="bi bi-x-lg"></i>
                </div>
            </div>
        </div>

        <div class="col-6 col-lg-3">
            <div class="stat-card stat-warning">
                <div class="stat-info">
                    <span class="stat-label">Stock Bajo</span>
                    <span class="stat-number loading-pulse" id="low-stock">-</span>
                </div>
                <div class="stat-icon-mini">
                    <i class="bi bi-exclamation-lg"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Informaci贸n adicional -->
<div class="row mt-4">
    <div class="col-md-6 mb-4">
        <div class="info-card">
            <div class="d-flex align-items-start justify-content-between mb-3">
                <div>
                    <h5 class="mb-1" style="color: var(--text-main); font-weight: 600;">
                        <i class="bi bi-info-circle text-primary"></i> Sistema
                    </h5>
                    <small class="text-muted">Informaci贸n del entorno</small>
                </div>
            </div>
            <table class="table table-sm table-borderless mb-0">
                <tr>
                    <td class="text-muted" style="width: 140px;">Entorno:</td>
                    <td>
                        {% if environment == 'production' %}
                        <span class="badge bg-success">
                            {{ environment|upper }}
                        </span>
                        {% else %}
                        <span class="badge bg-warning text-dark">
                            {{ environment|upper }}
                        </span>
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <td class="text-muted">Base de Datos:</td>
                    <td><code style="color: var(--text-main);">{{ db_prefix }}</code></td>
                </tr>
                <tr>
                    <td class="text-muted">Usuario Actual:</td>
                    <td style="color: var(--text-main);">{{ current_user.username }}</td>
                </tr>
                <tr>
                    <td class="text-muted">Email:</td>
                    <td style="color: var(--text-main);">{{ current_user.email }}</td>
                </tr>
            </table>
        </div>
    </div>

    <div class="col-md-6 mb-4">
        <div class="info-card">
            <div class="d-flex align-items-start justify-content-between mb-3">
                <div>
                    <h5 class="mb-1" style="color: var(--text-main); font-weight: 600;">
                        <i class="bi bi-person-circle text-primary"></i> Mi Cuenta
                    </h5>
                    <small class="text-muted">Gesti贸n de perfil</small>
                </div>
            </div>
            <p class="text-muted mb-3" style="font-size: 0.9rem;">
                Administra tu informaci贸n personal y configuraci贸n de seguridad
            </p>
            <div class="d-grid gap-2">
                <a href="{{ url_for('auth.profile') }}" class="btn btn-outline-primary btn-sm">
                    <i class="bi bi-person"></i> Ver Perfil Completo
                </a>
                <a href="{{ url_for('auth.change_password') }}" class="btn btn-outline-secondary btn-sm">
                    <i class="bi bi-key"></i> Cambiar Contrase帽a
                </a>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
    $(document).ready(function () {
        loadStats();
    });

    function loadStats() {
        $.ajax({
            url: '/products/stats',
            method: 'GET',
            success: function (response) {
                if (response.success) {
                    // Peque帽o delay artificial para que se aprecie la animaci贸n de carga (opcional)
                    setTimeout(() => {
                        updateStat('#total-products', response.stats.total);
                        updateStat('#in-stock', response.stats.published || 0);
                        updateStat('#out-stock', response.stats.draft || 0);
                        updateStat('#low-stock', response.stats.pending || 0);
                    }, 300);
                }
            },
            error: function () {
                console.log('Error al cargar estad铆sticas');
                $('.loading-pulse').removeClass('loading-pulse').text('Error');
            }
        });
    }

    function updateStat(selector, value) {
        const el = $(selector);
        el.removeClass('loading-pulse');
        // Animaci贸n simple de conteo o fade
        el.hide().text(value).fadeIn(400);
    }
</script>
{% endblock %}